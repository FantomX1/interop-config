<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
    <meta name="HandheldFriendly" content="True"/>
    <title>Examples</title>
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/cerulean/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://tobiju.github.io/share/prismjs/prism-ghcolors.css"/>
    <link rel="stylesheet"
          href="https://tobiju.github.io/share/prismjs/prism-linenumbers.css"/>
    <style>
        body, html {
            height: 100%;
            padding-top: 36px;
            position: relative;
        }

        img {
            max-width: 100%;
        }

        .page-wrapper {
            min-height: 100%;
            padding-bottom: 170px;
            position: relative;
        }

        /* Header Section */
        header {
            background: white;
            color: black;
            font-size: 16px;
            font-weight: 300;
        }

        h1:first-child {
            margin-top: 0;
        }

        /* anchor link will be displayed after the static top nav */
        h1:before,
        h2:before,
        h3:before,
        h4:before,
        h5:before,
        h6:before {
            display: block;
            content: " ";
            margin-top: -64px;
            height: 64px;
            visibility: hidden;
        }

        .navbar-brand {
            padding: 0;
        }

        .navbar-brand img {
            max-height: 100%;
        }

        /* Content Section */
        #content {
            margin-bottom: 17px;
            font-size: 17px;
            min-height: 200px;
        }

        .breadcrumb {
            position: relative;
            z-index: 999;
        }

        .links {
            background: #f8f8f8;
            border-top: 1px solid #e5e5e5;
            border-bottom: 1px solid #e5e5e5;
            padding: 16px 0;
        }

        .links .prev {
            text-align: left;
        }

        .links .parent {
            text-align: center;
        }

        .links .next {
            text-align: right;
        }

        /* TOC */
        .list-toc .list-group-item {
            background: 0 none;
            position: relative;
            font-weight: bold;
            padding: 0;
        }

        .list-toc .list-group-item .row {
            padding: 7px 0;
        }

        .list-toc .list-group-item .text-number {
            padding-left: 10px;
        }

        .list-toc .list-toc-nested .list-group-item {
            font-weight: normal;
            border: 0 none !important;
        }

        .list-toc .list-toc-nested {
            margin-bottom: 0;
            padding-bottom: 10px;
        }

        .list-toc .list-group-item .bbt-toc-toggle {
            display: block;
            position: absolute;
            top: 5px;
            right: 10px;
            font-weight: normal;
        }
        .list-toc .list-group-item .bbt-toc-toggle:before {
            content: "";
            display: block;
        }
        .list-toc .list-group-item .bbt-toc-toggle.collapsed:before {
            content: "";
            display: block;
        }

        .list-toc > li:nth-child(2n+1) {
            background: rgba(0, 0, 0, 0.03);
        }

        .bbt-theme-cyborg .list-toc > li:nth-child(2n+1),
        .bbt-theme-darkly .list-toc > li:nth-child(2n+1),
        .bbt-theme-slate .list-toc > li:nth-child(2n+1),
        .bbt-theme-superhero .list-toc > li:nth-child(2n+1) {
            background: rgba(255, 255, 255, 0.05);
        }

        .list-toc .list-group-item {
            border-bottom: 0 none;
            border-left: 0 none;
            border-right: 0 none;
            font-size: inherit;
        }

        .list-toc .list-group-item:first-child {
            border-top-right-radius: 0;
            border-top-left-radius: 0;
        }

        .list-toc .list-group-item:last-child {
            border-bottom-right-radius: 0;
            border-bottom-left-radius: 0;
        }

        /* Left navigation */
        .nav-left ul li a {
            padding-top: 3px;
            padding-bottom: 3px;
            border-left: 1px solid transparent;
        }
        .nav-left ul li.active a,
        .nav-left ul li a:hover {
            background: none !important;
            color: inherit;
            border-color: inherit;
        }

        .affix {
            top: 60px;
        }

        .badge {
            border-radius: 4px;
            padding: 5px;
        }

        /* Footer Section */
        footer {
            color: black;
            background: white;
            width: 100%;
            position: absolute;
            bottom: 0;
        }

        footer #copyright {
            padding: 30px;
            text-align: center;
            color: #444;
        }

        footer #copyright p {
            margin: 0;
        }

        footer #copyright span a {
            color: white;
        }

        /* Top Navigation */
        @media (max-width: 767px) {
            ul.navbar-nav {
                margin: 0 -15px
            }

            ul.navbar-nav li {
                border-radius: 0;
            }

            ul.navbar-nav li ul {
                background: rgba(255, 255, 255, 0.2);
                border: none;
                border-radius: 0;
                box-shadow: none;
                display: block;
                float: none;
                left: auto;
                padding: 0;
                position: static;
            }

            ul.navbar-nav li ul li a {
                padding: 8px 30px;
            }

            ul.navbar-nav li ul li ul li a {
                padding: 6px 40px;
            }
        }

        @media (min-width: 768px) {

            ul.navbar-nav li {
                display: block;
                position: relative;
                float: left;
            }

            ul.navbar-nav li ul {
                display: none;
            }

            ul.navbar-nav li a {
                display: block;
            }

            ul.navbar-nav li:hover > ul {
                display: block;
                position: absolute;
            }

            ul.navbar-nav li:hover li {
                float: none;
            }

            ul.navbar-nav ul ul {
                left: 100%;
                top: 0;
            }
        }
    </style>
    </head>
    <body data-spy="scroll" data-target="#sideNav" data-offset="50" class="bbt-theme-cerulean">
    <div class="page-wrapper">
        <header>
    <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#js-navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
                    </div>

        <div class="collapse navbar-collapse" id="js-navbar-collapse">
            
    
    <ul class="nav navbar-nav">
                        <li>
    <a href="/getting-started/">Getting Started</a>
    
    <ul class="dropdown-menu">
                        <li>
    <a href="/getting-started/overview.html">Overview</a>

    </li>
                        <li>
    <a href="/getting-started/quick-Start.html">Quick Start</a>

    </li>
            </ul>

    </li>
                        <li>
    <a href="/reference/">Reference</a>
    
    <ul class="dropdown-menu">
                        <li>
    <a href="/reference/api.html">API</a>

    </li>
                        <li>
    <a href="/reference/examples.html">Examples</a>

    </li>
            </ul>

    </li>
                        <li>
    <a href="/contribute/">Contribute</a>
    
    <ul class="dropdown-menu">
                        <li>
    <a href="/contribute/contributing.html">Contributing</a>

    </li>
                        <li>
    <a href="/contribute/readme-git.html">Using GIT</a>

    </li>
                        <li>
    <a href="/contribute/changelog.html">Changelog</a>

    </li>
            </ul>

    </li>
            </ul>

        </div>
    </div>
</nav>
</header>
<div class="container">
    <ol class="breadcrumb">
                        <li><a href="/">interop-config</a></li>
                                <li><a href="/reference/">Reference</a></li>
                                <li class="active">Examples</li>
            </ol>
    <div class="row">

                <div class="col-md-3">
            <nav class="nav-left hidden-xs hidden-sm" id="sideNav">
    <ul class="nav nav-stacked" data-spy="affix" data-offset-top="59" role="tablist">
                                <li>
                <a href="#2-2" title="Examples">Examples</a>
            </li>
                                <li>
                <a href="#2-2-1" title="Use&#x20;a&#x20;vendor.package.id&#x20;config&#x20;structure">Use a vendor.package.id ...</a>
            </li>
                                                                    <li>
                <a href="#2-2-2" title="Use&#x20;arbitrary&#x20;configuration&#x20;structure">Use arbitrary configurat...</a>
            </li>
            </ul>
</nav>
        </div>
                <div class="col-md-9">
<h1 id="2-2">2.2. Examples</h1>
<p>This files contains examples for each interface. The factory class uses the <code>ConfigurationTrait</code> to retrieve options
from a configuration and optional to perform a mandatory option check or merge default options. There is also an
example for a independent config structure of the Zend Expressive TwigRendererFactory.</p>
<h2 id="2-2-1">2.2.1. Use a vendor.package.id config structure</h2>
<p>Let's assume we have the following module configuration:</p>
<pre><code class="language-php">// interop config example
return [
    // vendor name
    'doctrine' =&gt; [
        // package name
        'connection' =&gt; [
            // container id
            'orm_default' =&gt; [
                // mandatory params
                'driverClass' =&gt; 'Doctrine\DBAL\Driver\PDOMySql\Driver',
                'params' =&gt; [
                    'host'     =&gt; 'localhost',
                    'port'     =&gt; '3306',
                    'user'     =&gt; 'username',
                    'password' =&gt; 'password',
                    'dbname'   =&gt; 'database',
                ],
            ], 
        ],
    ],
];
</code></pre>
<blockquote>
<p>Note that the configuration above is injected as <code>$config</code> in <code>options()</code></p>
</blockquote>
<h3 id="2-2-1-1">2.2.1.1. Retrieving options</h3>
<p>Then you have easily access to the <code>orm_default</code> options in your method with <code>ConfigurationTrait</code>.</p>
<pre><code class="language-php">use Interop\Config\ConfigurationTrait;
use Interop\Config\RequiresConfigId;

class MyDBALConnectionFactory implements RequiresConfigId
{
    use ConfigurationTrait;
    
    public function __invoke(ContainerInterface $container)
    {
        // get options for doctrine.connection.orm_default
        $options = $this-&gt;options($container-&gt;get('config'), 'orm_default');
        
        // check if mandatory options are available or use \Interop\Config\RequiresMandatoryOptions, see below 
        if (empty($options['driverClass'])) {
            throw new Exception\RuntimeException(
                sprintf(
                    'Driver class was not set for configuration %s.%s.%s',
                    'doctrine', 
                    'connection', 
                    'orm_default'
                )
            );
        }

        if (empty($options['params'])) {
            throw new Exception\RuntimeException(
                sprintf(
                    'Params was not set for configuration %s.%s.%s',
                    'doctrine', 
                    'connection', 
                    'orm_default'
                )
            );
        }

        $driverClass = $options['driverClass'];
        $params = $options['params'];

        // create your instance and set options

        return $instance;
    }
    
    /**
     * Is used to retrieve options from the configuration array ['doctrine' =&gt; ['connection' =&gt; [...]]].
     *
     * @return []
     */
    public function dimensions()
    {
        return ['doctrine', 'connection'];
    }
}
</code></pre>
<h3 id="2-2-1-2">2.2.1.2. Mandatory options check</h3>
<p>You can also check for mandatory options automatically with <code>MandatoryOptionsInterface</code>. Now we want also check that
option <code>driverClass</code> and <code>params</code> are available. So we also implement in the example above the interface
<code>RequiresMandatoryOptions</code>. If one of these options is missing, an exception is raised.</p>
<pre><code class="language-php">use Interop\Config\ConfigurationTrait;
use Interop\Config\RequiresMandatoryOptions;
use Interop\Config\RequiresConfigId;

class MyDBALConnectionFactory implements RequiresConfigId, RequiresMandatoryOptions
{
    use ConfigurationTrait;
    
    public function __invoke(ContainerInterface $container)
    {
        // get options for doctrine.connection.orm_default
        $options = $this-&gt;options($container-&gt;get('config'), 'orm_default');

        // mandatory options check is automatically done by RequiresMandatoryOptions

        $driverClass = $options['driverClass'];
        $params = $options['params'];

        // create your instance and set options

        return $instance;
    }

    /**
     * Returns a list of mandatory options which must be available
     *
     * @return string[] List with mandatory options
     */
    public function mandatoryOptions()
    {
        return [
            'driverClass',
            'params',
        ];
    }
    
    /**
     * Is used to retrieve options from the configuration array ['doctrine' =&gt; ['connection' =&gt; [...]]].
     *
     * @return []
     */
    public function dimensions()
    {
        return ['doctrine', 'connection'];
    }
}
</code></pre>
<h3 id="2-2-1-3">2.2.1.3. Default options</h3>
<p>Use the <code>ProvidesDefaultOptions</code> interface if you have default options. These options are merged with the provided options in
<code>\Interop\Config\RequiresConfig::options()</code>. Let's look at this example from
<a href="https://github.com/doctrine/DoctrineORMModule/blob/master/docs/configuration.md#how-to-use-two-connections">DoctrineORMModule</a>.
All the options under the key <em>orm_crawler</em> are optional, but it's not visible in the factory.</p>
<pre><code class="language-php">return [
    'doctrine' =&gt; [
        'configuration' =&gt; [
            'orm_crawler' =&gt; [
                'metadata_cache'    =&gt; 'array',
                'query_cache'       =&gt; 'array',
                'result_cache'      =&gt; 'array',
                'hydration_cache'   =&gt; 'array',
            ],
        ],
    ],
];
</code></pre>
<pre><code class="language-php">use Interop\Config\ConfigurationTrait;
use Interop\Config\ProvidesDefaultOptions;
use Interop\Config\RequiresConfigId;

class ConfigurationFactory implements RequiresConfigId, ProvidesDefaultOptions
{
    use ConfigurationTrait;
    
    public function __invoke(ContainerInterface $container)
    {
        // get options for doctrine.configuration.orm_crawler
        $options = $this-&gt;options($container-&gt;get('config'), 'orm_crawler');

        # these keys are always available now 
        $options['metadata_cache'];
        $options['query_cache'];
        $options['result_cache'];
        $options['hydration_cache'];

        // create your instance and set options

        return $instance;
    }
    
    /**
     * Returns a list of default options, which are merged in \Interop\Config\RequiresConfig::options
     *
     * @return string[] List with default options and values
     */
    public function defaultOptions()
    {
        return [
            'metadata_cache' =&gt; 'array',
            'query_cache' =&gt; 'array',
            'result_cache' =&gt; 'array',
            'hydration_cache' =&gt; 'array',
        ];
    }
    
    /**
     * Is used to retrieve options from the configuration array 
     * ['doctrine' =&gt; ['configuration' =&gt; []]].
     *
     * @return []
     */
    public function dimensions()
    {
        return ['doctrine', 'configuration'];
    }
}
</code></pre>
<h2 id="2-2-2">2.2.2. Use arbitrary configuration structure</h2>
<p>Whatever configuration structure you use, <code>interop-config</code> can handle it. You can use a three-dimensional array with
<code>vendor.package.id</code> like the examples above or you don't care of it and organize your configuration by behavior or
nature (db, cache, ... or sale, admin).</p>
<p>The following example demonstrates how to replace the <a href="https://github.com/zendframework/zend-expressive-twigrenderer/blob/e1dd1744bf9ba5ec364fc1320566699d04f407c4/src/TwigRendererFactory.php">Zend Expressive TwigRendererFactory</a>.
The factory uses optionally the following config structure:</p>
<pre><code class="language-php">return [
    'debug' =&gt; true,
    'templates' =&gt; [
        'cache_dir' =&gt; 'path to cached templates',
        'assets_url' =&gt; 'base URL for assets',
        'assets_version' =&gt; 'base version for assets',
        'extension' =&gt; 'file extension used by templates; defaults to html.twig',
        'paths' =&gt; [
            // namespace / path pairs
            //
            // Numeric namespaces imply the default/main namespace. Paths may be
            // strings or arrays of string paths to associate with the namespace.
        ],
    ],
    'twig' =&gt; [
        'cache_dir' =&gt; 'path to cached templates',
        'assets_url' =&gt; 'base URL for assets',
        'assets_version' =&gt; 'base version for assets',
        'extensions' =&gt; [
            // extension service names or instances
        ],
    ],
];
</code></pre>
<p>You can see that the factory uses different keys (debug, templates, twig) of the config array on the same level. This
configuration is maybe used by other factories too like the <code>debug</code> setting. <code>interop-config</code> reduces the checks in the
factory and gives the user the possibility to find out the config structure. More than that, it is possible to create the
configuration file from the factory.</p>
<pre><code class="language-php">namespace Zend\Expressive\Twig;

use Interop\Container\ContainerInterface;
use Twig_Environment as TwigEnvironment;
use Twig_Extension_Debug as TwigExtensionDebug;
use Twig_ExtensionInterface;
use Twig_Loader_Filesystem as TwigLoader;
use Zend\Expressive\Router\RouterInterface;

// interop-config
use Interop\Config\ConfigurationTrait;
use Interop\Config\RequiresConfig;
use Interop\Config\ProvidesDefaultOptions;

class TwigRendererFactory implements RequiresConfig, ProvidesDefaultOptions
{
    use ConfigurationTrait;

    /**
     * Uses root config to retrieve several options
     *
     * @return array
     */
    public function dimensions()
    {
        return [];
    }

    /**
     * This is the whole config structure with default settings for this factory
     */
    public function defaultOptions()
    {
        return [
            'debug' =&gt; false,
            'templates' =&gt; [
                'extension' =&gt; 'html.twig',
                'paths' =&gt; [],
            ],
            'twig' =&gt; [
                'cache_dir' =&gt; false,
                'assets_url' =&gt; '',
                'assets_version' =&gt; '',
                'extensions' =&gt; [],
            ],
        ];
    }

    /**
     * @param ContainerInterface $container
     * @return TwigRenderer
     */
    public function __invoke(ContainerInterface $container)
    {
        $config = $container-&gt;has('config') ? $container-&gt;get('config') : [];

        // no OptionNotFoundException is thrown from ConfigurationTrait, because there are no config dimensions
        $config = $this-&gt;options($config);

        $debug = (bool) $config['debug'];

        // Create the engine instance
        $loader      = new TwigLoader();
        $environment = new TwigEnvironment($loader, [
            'cache'            =&gt; $debug ? false : $config['twig']['cache_dir'],
            'debug'            =&gt; $debug,
            'strict_variables' =&gt; $debug,
            'auto_reload'      =&gt; $debug
        ]);
        // Add extensions
        if ($container-&gt;has(RouterInterface::class)) {
            $environment-&gt;addExtension(new TwigExtension(
                $container-&gt;get(RouterInterface::class),
                $config['twig']['assets_url'],
                $config['twig']['assets_version']
            ));
        }
        if ($debug) {
            $environment-&gt;addExtension(new TwigExtensionDebug());
        }
        // Add user defined extensions
        $this-&gt;injectExtensions($environment, $container, $config['twig']['extensions']);
        // Inject environment
        $twig = new TwigRenderer($environment, $config['templates']['extension']);
        // Add template paths
        foreach ($config['templates']['paths'] as $namespace =&gt; $paths) {
            $namespace = is_numeric($namespace) ? null : $namespace;
            foreach ((array) $paths as $path) {
                $twig-&gt;addPath($path, $namespace);
            }
        }
        return $twig;
    }
    /**
     * Inject extensions into the TwigEnvironment instance.
     *
     * @param TwigEnvironment $environment
     * @param ContainerInterface $container
     * @param array $extensions
     * @throws Exception\InvalidExtensionException
     */
    private function injectExtensions(TwigEnvironment $environment, ContainerInterface $container, array $extensions)
    {
        foreach ($extensions as $extension) {
            // Load the extension from the container
            if (is_string($extension) &amp;&amp; $container-&gt;has($extension)) {
                $extension = $container-&gt;get($extension);
            }
            if (! $extension instanceof Twig_ExtensionInterface) {
                throw new Exception\InvalidExtensionException(sprintf(
                    'Twig extension must be an instance of Twig_ExtensionInterface; "%s" given,',
                    is_object($extension) ? get_class($extension) : gettype($extension)
                ));
            }
            if ($environment-&gt;hasExtension($extension-&gt;getName())) {
                continue;
            }
            $environment-&gt;addExtension($extension);
        }
    }
    // The mergeConfig function is not needed anymore
    // private function mergeConfig($config)
}
</code></pre>
        </div>
    </div>
</div>

<footer>
    <div class="links">
        <div class="container">
            <div class="row">
                <div class="prev col-xs-6">
                                            <a href="/reference/api.html">Previous</a>                                    </div>
                <div class="next col-xs-6">
                                            <a href="/contribute/">Next</a>                                    </div>
            </div>
        </div>
    </div>
    <div id="copyright">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <p>Copyright (c) 2015-2016 <a href="https://sandro-keil.de/" title="I write about topics, advices and trends of web development">Sandro Keil</a> <br/> Powered by <a href="https://github.com/tobiju/bookdown-bootswatch-templates" title="Visit project to generate your own docs">Bookdown Bootswatch Templates</a></p>
                </div>
            </div>
        </div>
    </div>
</footer>
    </div>
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
            integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
            crossorigin="anonymous"></script>
    <script src="https://tobiju.github.io/share/prismjs/main.js"></script>
    <script src="https://tobiju.github.io/share/prismjs/prism.js"></script>
</body>
</html>
